# 工具注册与调用路由 - 需求说明

## 目标与范围
- 目标：标准化工具注册，支持基于规则/模型的路由与调用，失败可重试/降级。
- 范围：工具清单管理、启用/禁用、入参/出参加载、路由策略、执行反馈。

## 用户故事
- 作为用户，我希望系统自动为我的问题选择合适的工具链。
- 作为用户，我希望看到每步工具执行的进度与失败原因，并能重试。

## 主流程
1. 设置页展示工具清单：名称、描述、入参/出参加载、绑定提示词、启用状态。
2. 发送对话时，意图分类→规则/模型决定工具链→按顺序或并行执行。
3. 执行过程将步骤/进度推送到对话流或主窗口。
4. 失败自动重试一次；仍失败则降级为纯模型回答，并提示缺失数据/失败原因。

## 关键交互
- 工具行内可启用/禁用；编辑弹窗配置入参/出参示例与提示词。
- 路由决策可在日志/面包屑中展示（如：命中规则/模型判定）。
- 执行步骤卡片显示状态（运行/成功/失败），可展开查看入参/出参摘要。
- “重试”按钮沿用上次参数；“复制请求”便于排障。

## 边界与异常
- 工具被禁用时，不参与路由并在决策日志标注。
- 并行工具互相依赖冲突时，按依赖图调整顺序或提示无法并行。
- 返回结构异常时，提示“结果格式错误”并附示例。

## 非功能
- 路由决策 < 500ms；单工具调用超时默认 < 8s（可配置）。
- 执行日志推送不阻塞主线程，UI 渲染 < 200ms。

## 依赖
- 工具注册存储；规则/模型意图分类；编排执行器；进度推送。

## 验收标准
- 工具清单可增改删/启用禁用；路由能正确选择工具链。
- 执行过程展示步骤与进度；失败自动重试一次，降级提示准确。

