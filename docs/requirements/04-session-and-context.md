# 会话与资源上下文 - 需求说明

## 目标与范围
- 目标：在会话中关联资源上下文，支持查看来源、清空与恢复选择，长会话折叠。
- 范围：上下文绑定、来源可视化、清空/恢复、历史折叠与加载更多。

## 用户故事
- 作为用户，我能知道本轮对话用了哪些资源作为上下文。
- 作为用户，我可清空上下文重新开始，或恢复上次选择。

## 主流程
1. 资源管理器选中节点后，节点 ID/路径绑定到当前会话上下文。
2. 发送消息时，将节点列表随请求提交；消息气泡可查看“上下文来源”。
3. 提供“清空上下文”按钮重置；提供“恢复上次选择”快速恢复。
4. 长会话自动折叠历史消息，滚动加载更多。

## 关键交互
- 消息气泡内的“上下文来源”可展开查看节点列表及类型标签。
- 清空后在提示条显示“已清空上下文”；恢复按钮回填之前的节点选择。
- 折叠提示“已折叠 N 条”，点击加载更多。

## 边界与异常
- 绑定的节点在资源树刷新后不存在，则在来源里标记“已移除”，提示用户更新。
- 发送时如上下文为空且策略要求上下文，提示“请选择资源或确认无上下文”。

## 非功能
- 上下文序列化与提交开销可忽略，不显著增加发送延迟。
- 历史折叠/加载更多渲染 < 300ms。

## 依赖
- 资源管理器节点数据；会话存储能保存关联节点；对话编排接受上下文列表。

## 验收标准
- 消息能携带并展示上下文来源；清空与恢复功能可用。
- 长会话折叠与加载更多行为正确，不丢消息。

