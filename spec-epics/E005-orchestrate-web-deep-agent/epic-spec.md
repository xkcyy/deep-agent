## 概览与目标

- 打造基于 Web 的深度智能体，结合虚拟文件系统（VFS）提升本地文档的可见性、可检索性，并以“编码智能体”体验支持开发者高效完成代码/知识类任务。
- 业务目标：让用户在单一 Web 工作区完成文档挂载、检索、任务下达与结果复用，降低上下文切换与信息搜集成本。
- 成功度量（史诗级）：Top3 文档命中率 ≥85%，端到端任务完成时间较人工基线提升 ≥30%，单次会话平均反馈轮次 ≤3，关键操作（挂载、检索、执行）成功率 ≥99%。

## 业务流程 / 用户旅程

1. 进入工作区：用户通过 Web 进入工作区，选择或创建会话。
2. 文档挂载与扫描：授权挂载本地目录/文件到 VFS，启动元数据与内容扫描。
3. 索引与检索：生成索引；用户通过搜索/语义问答获取相关文档段落与上下文。
4. 任务下达：用户输入编码/分析类目标，选择参考文档或让智能体自动挑选。
5. 智能体推理与规划：智能体基于检索结果拆解步骤，生成行动计划并获取确认。
6. 结果呈现与交付：以可复用的输出格式（说明、建议、补丁草案等）展示，并允许导出/复盘。
7. 反馈与迭代：用户对结果给出反馈，触发追加检索或计划调整，形成可审计的记录。

## 范围内 / 范围外

- 范围内：Web 端工作区、VFS 挂载/索引/检索、基于文档的智能体规划与回应、会话与历史留存、基础安全与可观测。
- 范围外：真实代码执行或外部仓库写入（仅生成建议/补丁稿）、生产级 CI/CD 集成、收费/结算、移动端。

## 角色 / 细分用户

- 主用户：开发者/技术顾问（高频检索、需要基于本地文档快速生成方案/补丁草案）。
- 次用户：产品/项目角色（查看方案、复盘会话、提出改进反馈）。
- 守护者：安全/合规负责人（关注数据访问、脱敏、留痕与权限）。

## 关键业务场景

- 主路径（挂载到交付）：
  1. 挂载目录 → 2) 自动扫描/索引 → 3) 搜索确认上下文 → 4) 输入任务 → 5) 智能体生成计划并确认 → 6) 输出可复用结果（含来源引用） → 7) 反馈/二次检索。
- 衍生场景：多会话并行对照、历史结果复用、跨文档对比、合规审计视图。

## 功能需求（技术无关）

- 工作区与会话：支持创建/切换会话；保留历史任务、检索记录与结果。
- VFS 挂载与管理：选择本地目录/文件挂载；显示挂载状态、扫描进度；可暂停/重新扫描。
- 索引与检索：自动索引；关键词/语义搜索；结果需包含来源路径/片段；支持按文件类型/时间过滤。
- 任务输入与上下文绑定：任务可引用选中的检索结果或自动挑选的上下文；允许用户锁定/排除特定文档。
- 智能体规划与回应：智能体先给出分步计划与所需上下文，用户确认后生成结果；结果需可追溯至来源文档。
- 结果呈现与导出：支持多种输出形态（说明、检查清单、补丁稿草案）；可复制/下载；保留引用。
- 反馈与迭代：用户可标记结果有效性并请求改进；支持重新检索或微调计划。
- 守护与审计：记录关键操作（挂载、检索、任务、输出）；基础权限控制与操作留痕。

## 非功能需求

- 性能：挂载后首次可检索时间 ≤5 分钟（中等规模文档集）；检索查询 P95 ≤2 秒；计划/回应生成 P95 ≤10 秒。
- 可用性：核心操作成功率 ≥99%；异常需可重试且有用户指引。
- 安全/隐私：只读访问本地文档；敏感字段需支持脱敏/过滤；操作留痕可导出。
- 可观测：关键指标采集（挂载成功率、索引时长、检索召回、回应时延）；错误日志具备可追踪请求 ID。
- 兼容性：兼容常见文本/代码/文档格式（需明确覆盖范围）；Web 端主流浏览器下体验一致。

## 约束与假设

- 默认仅生成建议与补丁稿，不直接改写本地文件。
- 用户可授予对本地文件/目录的只读访问；大规模文档集可能分批索引。
- 需要可配置的数据驻留/清理策略（本地缓存、会话数据）。
- 采用 SOLID 设计思想规划模块边界（VFS、检索、规划、会话、审计解耦）。

## 依赖

- 本地文件系统访问能力与权限授权。
- LLM/向量语义能力（用于检索增强与规划），需可替换。
- 浏览器可用性与网络连通性（用于 Web 端交互与必要的推理/索引服务）。

## 成功标准

- 检索：Top3 文档命中率 ≥85%，噪声结果占比 ≤10%。
- 任务完成：基于建议/补丁稿能在 1 小时内完成目标的用户占比 ≥80%。
- 体验：用户对结果相关性与可用性的满意度 ≥4.2/5，平均反馈轮次 ≤3。
- 合规：关键操作 100% 具备审计记录；敏感字段泄露事件为 0。

## 风险与缓解

- 大规模文档导致索引/检索性能劣化 → 分批索引与进度可视化，允许按目录/类型选择。
- 隐私与敏感数据风险 → 仅读访问、脱敏/过滤策略、可导出的审计日志。
- 上下文错误或幻觉 → 强制显示引用，要求用户确认计划后再生成结果，允许快速纠偏。
- 依赖外部模型可用性 → 需可替换的推理/嵌入服务，提供降级路径（关键词搜索）。

## 边界情形

- 挂载目录中混合二进制/不可解析文件：跳过并提示，仅索引可解析格式。
- 索引过程中中断/失败：保留已完成部分并可恢复；用户可重试或重新挂载。
- 文档被外部更新/删除：提示索引失效并允许重新扫描；搜索结果需标记过期。
- 用户撤回权限：立即停止访问并清理缓存，提示会话受影响。

## [NEEDS CLARIFICATION]

- 需明确支持的文档/代码类型与规模上限（影响索引策略与切片粒度）。
- 需明确数据驻留/脱敏与审计保留政策（本地缓存、日志、会话数据的生命周期）。
- 需明确智能体输出可执行动作的边界（仅建议/补丁稿？是否允许半自动应用）。
