# 迭代规划

## 迭代 1：Trae 风格壳层与会话框架
- 阶段覆盖：A（进入与会话创建）+ 部分 B（连接入口但暂不读写）。
- 范围边界：包含多栏导航与布局框架、会话列表/创建/恢复、基础身份入口与状态提示；不含仓库读取、对话生成、任何写操作。
- 进入条件：确定目标布局与导航信息架构；可用的身份占位或最简登录。
- 退出条件（DoD）：可创建/切换/归档会话；固定侧边栏与上下文/对话占位可用；空态与错误态提示完整；基本可用性检查通过。
- 关键场景：登录后创建新会话、恢复上次会话、在多栏间切换视图。
- 依赖：设计规范（参考 Trae）、身份/会话存储策略。
- 风险与缓解：布局复杂度导致可用性下降 → 快速可用性走查、键盘操作与缩放自适应；身份缺失 → 提供匿名/本地会话占位。
- 里程碑/指标：可用性走查通过率 ≥ 90%；关键交互（切换栏、创建会话）错误率 < 1%。

## 迭代 2：工作区连接与上下文加载
- 阶段覆盖：B（连接工作区）+ C 部分（只读探索）。
- 范围边界：包含仓库连接与验证、文件树浏览、文件查看、基础搜索/跳转、上下文面板选取；不含任何生成与写入。
- 进入条件：迭代 1 布局稳定；具备仓库访问凭证。
- 退出条件（DoD）：用户可选择仓库/分支、浏览文件树、查看文件内容（含大文件提示）、搜索并跳转；上下文片段可绑定到会话；错误与权限不足有明确提示。
- 关键场景：连接仓库、浏览模块、将文件片段加入上下文。
- 依赖：VCS 访问、文件渲染与搜索能力。
- 风险与缓解：大仓库性能 → 懒加载与分页；权限不足 → 只读模式提示与重试。
- 里程碑/指标：文件树加载 P95 ≤ 2s（1k 文件）；上下文绑定成功率 ≥ 95%。

## 迭代 3：对话理解与计划生成
- 阶段覆盖：C（探索与提问）+ D（规划与审阅的计划阶段）。
- 范围边界：包含多轮对话、引用文件片段的回答、生成分步计划（含依赖/假设/风险）、用户可编辑与确认计划；不含差异生成与写入。
- 进入条件：迭代 2 完成且上下文可用；模型/推理服务可用。
- 退出条件（DoD）：可发起问答并返回带来源标注的回答；生成计划包含步骤、依赖、假设、风险；用户可编辑并确认计划；拒绝/重新生成路径可用。
- 关键场景：针对模块提问、生成并调整计划、确认计划进入下一步。
- 依赖：模型/推理服务、上下文检索。
- 风险与缓解：幻觉/误导 → 强制来源标注与假设列表；计划过长 → 步骤分组与精简提示。
- 里程碑/指标：回答 P95 ≤ 3s；计划被用户确认的比例 ≥ 60%；回答带来源覆盖率 ≥ 90%。

## 迭代 4：差异生成与审阅体验
- 阶段覆盖：D（规划后）+ E（预览/批准）。
- 范围边界：包含基于已确认计划生成差异、逐文件折叠视图、内联批注、逐条批准/驳回、导出补丁；不含真实写入或命令执行。
- 进入条件：迭代 3 计划确认流程可用。
- 退出条件（DoD）：可生成多文件差异并按文件/块浏览；每条差异可批注与批准/驳回；导出补丁成功；错误与不支持文件有提示。
- 关键场景：生成差异、审阅并批注、导出补丁。
- 依赖：差异生成服务、文件渲染。
- 风险与缓解：差异不可信 → 重生成与来源对齐提示；大补丁性能 → 分段加载与进度反馈。
- 里程碑/指标：差异生成 P95 ≤ 10s（异步可接受）；至少 80% 差异被完整渲染；用户满意度 ≥ 4.2/5。

## 迭代 5：受控应用、回滚与治理
- 阶段覆盖：E（批准后）+ F/G（应用与归档）。
- 范围边界：包含对已批准差异的受控应用（写入/生成补丁二选一或可配置）、冲突检测、备份/撤销、操作与安全日志、基础权限与高危提示、会话归档与报告导出；不含 CI/CD 部署。
- 进入条件：迭代 4 导出补丁可用；明确的写入权限策略已确定。
- 退出条件（DoD）：用户可选择应用模式（仅补丁/受控写入）；写入前进行冲突/权限检查；应用后可撤销；全链路日志可导出；会话可归档生成报告。
- 关键场景：批准后应用变更、遇到冲突回滚、导出审计报告。
- 依赖：写入权限与安全策略、日志/存储。
- 风险与缓解：误操作 → 默认补丁模式、二次确认、撤销；权限滥用 → 角色分级与高危提示；日志缺失 → 强制记录关键事件。
- 里程碑/指标：未经批准写入为 0；应用成功率 ≥ 95%；回滚成功率 ≥ 95%；日志覆盖率 100%。

# Specify 队列（按迭代顺序）
- 迭代 1 `/speckit.specify` 草稿
  - 短名：`shell-trae-layout`
  - 描述：构建 Trae 风格多栏壳层与会话框架，支持会话创建/切换/恢复与基础状态管理。
  - 成功标准骨架：完成会话创建/切换/归档；关键导航操作错误率 <1%；可用性走查通过率 ≥90%。
  - 澄清：沿用史诗澄清（不新增）。

- 迭代 2 `/speckit.specify` 草稿
  - 短名：`workspace-connect`
  - 描述：连接单一仓库并提供文件树/查看/搜索与上下文绑定的只读体验。
  - 成功标准骨架：文件树加载 P95 ≤2s；上下文绑定成功率 ≥95%；权限错误均有提示。
  - 澄清：沿用史诗澄清（不新增）。

- 迭代 3 `/speckit.specify` 草稿
  - 短名：`chat-plan`
  - 描述：支持带来源标注的问答与分步计划生成/编辑/确认，包含依赖、假设与风险。
  - 成功标准骨架：回答 P95 ≤3s；计划确认率 ≥60%；回答来源覆盖率 ≥90%。
  - 澄清：沿用史诗澄清（不新增）。

- 迭代 4 `/speckit.specify` 草稿
  - 短名：`diff-review`
  - 描述：基于已确认计划生成可审阅的多文件差异，支持批注、逐条批准/驳回与补丁导出。
  - 成功标准骨架：差异生成 P95 ≤10s；80% 差异完整渲染；用户满意度 ≥4.2/5。
  - 澄清：沿用史诗澄清（不新增）。

- 迭代 5 `/speckit.specify` 草稿
  - 短名：`controlled-apply`
  - 描述：对已批准差异执行受控应用/补丁输出，具备冲突检测、撤销、日志与报告导出。
  - 成功标准骨架：未经批准写入为 0；应用/回滚成功率 ≥95%；日志覆盖率 100%。
  - 澄清：沿用史诗澄清（不新增）。

