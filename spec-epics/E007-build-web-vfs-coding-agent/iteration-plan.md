## 迭代列表

### Iteration 1 – VFS 信息架构与最小索引

- 摘要：定义虚拟文件系统抽象，打通最小可用的目录扫描与元数据索引。
- 覆盖阶段/泳道：启动与环境感知 → 资料摄取。
- 范围边界：包含基本目录配置、白/黑名单规则、索引状态可视化；不包含全文切分、复杂格式解析。
- 进入条件：明确可访问的测试目录；具备读取元数据的权限。
- 退出条件：可在 Web 控制台完成扫描配置并得到可见的索引清单，索引成功/失败节点可区分。
- 关键用户场景：选定目录 → 触发扫描 → 查看索引结果/失败原因。
- 依赖：本地文件系统权限；基础元数据读取库。
- 风险与缓解：权限不足 → 提前校验并提示；体量过大 → 支持范围限额提示与分批扫描。
- 里程碑/指标：可索引 ≥1 个目录并展示结果；索引失败节点可见率 100%。

### Iteration 2 – 文档切分与检索体验

- 摘要：实现文档切分、索引刷新与基础检索排序，提供引用可视化。
- 覆盖阶段/泳道：资料摄取 → 查询与检索。
- 范围边界：包含常见文本/代码切分与分片检索、引用展示；不包含高级语义 rerank 或跨仓合并策略。
- 进入条件：最小索引可用且有样本目录。
- 退出条件：用户可搜索关键词/文件名并得到排序结果，附带引用路径与片段。
- 关键用户场景：输入查询 → 查看排序结果 → 展开引用片段。
- 依赖：Iteration 1 的索引数据；切分/检索库。
- 风险与缓解：召回质量不足 → 提供过滤/排序开关；索引刷新时阻塞检索 → 引入增量或队列提示。
- 里程碑/指标：典型检索 ≤3s（缓存场景）；引用展示覆盖率 ≥90%。

### Iteration 3 – Web 交互与对话编排

- 摘要：完善 Web 控制台对话与表单交互，支持锁定/剔除检索片段并重放历史。
- 覆盖阶段/泳道：查询与检索 → 规划与执行入口。
- 范围边界：包含对话界面、片段选择、历史重放；不包含复杂多代理协作。
- 进入条件：检索结果可用，接口可供前端调用。
- 退出条件：用户可在对话中查看检索结果、手动锁定/剔除片段，并保存/重放历史会话。
- 关键用户场景：提出问题 → 系统检索 → 用户调整上下文 → 保存/重放。
- 依赖：Iteration 2 的检索 API；前端框架与会话存储。
- 风险与缓解：上下文选择过多导致界面复杂 → 提供默认折叠与推荐选择；历史存储超限 → 清理策略与上限提示。
- 里程碑/指标：用户可锁定/剔除片段并重新生成结果；历史重放成功率 ≥95%。

### Iteration 4 – 规划与执行链路（编码智能体草稿）

- 摘要：将检索片段转化为步骤化规划与草稿输出，标注引用与不确定区域。
- 覆盖阶段/泳道：规划与执行 → 结果交付。
- 范围边界：包含分步计划生成、草稿输出（说明/代码片段/操作步骤）、引用标注；不包含真实代码运行沙箱实现。
- 进入条件：对话编排可提供已锁定的上下文。
- 退出条件：用户可从检索结果生成计划与草稿，草稿包含引用标记与不确定性提示。
- 关键用户场景：用户确认上下文 → 系统给出步骤计划 → 生成草稿输出并可导出。
- 依赖：Iteration 3 的上下文选择能力；规划/生成模型接口。
- 风险与缓解：幻觉或引用缺失 → 强制引用标注，提示低置信度区域；输出过长 → 分段展示与可折叠。
- 里程碑/指标：草稿输出引用标注覆盖率 ≥90%；单次生成可在 <8s 完成（常规体量）。

### Iteration 5 – 性能、安全与可观测收尾

- 摘要：完善性能、权限提醒、可观测性与降级策略，形成验收基线。
- 覆盖阶段/泳道：跨阶段收尾（摄取/检索/规划/结果）。
- 范围边界：包含性能基线、敏感目录授权提示、检索/生成指标面板、重试/降级策略；不包含企业级审计与长时任务调度。
- 进入条件：前四个迭代功能可用。
- 退出条件：关键链路的性能与可观测指标可见，权限提示到位，降级路径可验证。
- 关键用户场景：高负载检索或索引刷新时，系统提示/降级仍可用；用户查看性能与错误日志面板。
- 依赖：前序迭代的日志/指标埋点；权限策略。
- 风险与缓解：性能目标无法达成 → 设定体量上限与分批策略；权限提示被忽略 → 强制确认与高亮告警。
- 里程碑/指标：检索 P50 <3s / P95 <6s（目标）；敏感目录访问前需显式确认率 100%；错误可追溯率 ≥95%。

## Specify 队列（按迭代顺序）

- Iteration 1 输入草稿：
  - 推荐短名：vfs-mvp-index
  - 描述：定义 VFS 抽象，完成目录扫描、元数据索引与状态可视化的最小能力。
  - 成功标准骨架：可索引指定目录；成功/失败节点可区分；索引结果可在 Web 控制台查看与导出。
  - 澄清提示：[NEEDS CLARIFICATION: 目标目录体量上限与需要支持的操作系统/文件权限模型？]
- Iteration 2 输入草稿：
  - 推荐短名：vfs-chunk-search
  - 描述：实现常见文档/代码切分、检索排序与引用展示，支持增量刷新提示。
  - 成功标准骨架：检索响应 <3s（缓存场景）；引用展示覆盖 ≥90%；刷新期间有可视化状态。
  - 澄清提示：若需高级语义排序或跨仓合并，需确认优先级。
- Iteration 3 输入草稿：
  - 推荐短名：web-dialog-context
  - 描述：提供对话/表单交互、片段锁定/剔除、历史重放的前端体验。
  - 成功标准骨架：用户可锁定/剔除片段后再生成；历史重放成功率 ≥95%；界面状态与后端同步。
  - 澄清提示：如需多用户协作/会话共享，需确认权限模型。
- Iteration 4 输入草稿：
  - 推荐短名：plan-and-draft
  - 描述：将检索片段转化为分步计划与草稿输出，附引用与不确定标识。
  - 成功标准骨架：草稿引用覆盖 ≥90%；生成耗时 <8s（常规体量）；不确定区域明确提示。
  - 澄清提示：输出格式优先级（代码片段、说明、操作步骤）及导出需求需确认。
- Iteration 5 输入草稿：
  - 推荐短名：perf-sec-observe
  - 描述：补齐性能、权限提示、可观测性与降级策略，形成验收基线。
  - 成功标准骨架：检索 P50/P95 达标；敏感访问需显式确认；错误与性能数据可追溯。
  - 澄清提示：指标展示形式（面板/日志导出）与留存周期需确认。
