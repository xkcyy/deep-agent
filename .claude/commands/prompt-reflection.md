---
description: 基于历史对话/产出对任意命令或系统提示词进行自我反思与提示词优化，形成可落地的修订片段与校验清单。
---

## User Input

```text
$ARGUMENTS
```

执行前必须审视用户输入（若不为空）。

## 目标

- 以通用方式对任意命令/系统提示词做自我反思与优化，提升稳定性、可执行度与安全性。
- 利用历史对话/产出诊断问题，并生成可插拔的修订片段（目标/输入/流程/输出/护栏）。

## 触发与输入

- 触发：显式调用 `/prompt-reflection`，可在命令后附简述注意点。
- 输入获取策略（容错）：
  - 优先使用用户显式提供的注意点/补充信息。
  - 若未显式提供，默认从本轮及前序对话中抽取 `command_context`（目标命令/提示词的用途与要求）、`history`（相关输出样本/失败案例）、`goal`（期望改进方向或成功判据）、`constraints`（安全、合规、长度、风格等）。
  - 若关键要素缺失且无法从上下文推断，列入“需澄清项”，但仍给出基于现有信息的最佳修订建议。
  - `known_failures`：若上下文可解析到问题点，归档于此；否则留空并标注缺口。

## 流程（含自检与澄清）

1. 读取与对齐
   - 提炼 `command_context` 的目标/受众/输出格式/边界。
2. 失败提炼
   - 从 `history` 标记失败或不理想样例与症状。
3. 澄清检查
   - 若缺成功判据、输出格式、约束、边界/前置，列出“需澄清项”；信息不足不臆测。可基于已有上下文先给临时假设，但需显式标注为假设。
4. 根因假设
   - 对主要问题提出可能根因（如目标不清、缺少校验步骤、缺失示例、护栏不足或冲突）。
5. 提示词修订
   - 生成可插拔的“修订版提示词片段”，覆盖：目标、输入要求、步骤（含校验钩子）、输出格式、护栏；保持模板化与通用性。
6. 自检
   - 用短清单核对修订方案：目标覆盖、可执行、含校验、长度可控、安全合规、避免幻觉。
7. 结构化输出
   - 按“输出格式”返回，确保可直接被命令系统解析。

## 输出格式（模板）

- `status`: `ready` | `needs-clarification`
- `summary`: 3-5 条改进要点
- `issues`: [{title, evidence_from_history, likely_cause}]
- `clarifications` (若需): [需澄清问题列表]
- `revised_prompt`:
  - `goal`
  - `inputs`
  - `process` (分步 + 校验点)
  - `output_format`
  - `guardrails`
- `self_check`: [检查要点列表]
- `notes` (可选): 适用范围/兼容性/风险

## 护栏

- 不臆造缺失信息；缺则列“需澄清项”。
- 不削弱既有安全/合规约束；发现冲突需显式标出。
- 控制长度，保持结构稳定、可解析。
- 引用仅基于提供的 `history`，不添加未给出的事实。
- 默认遵循用户语言（无特别说明则使用中文）。
