# 对话窗口详细 UI 设计文档（对齐 002-dialog-ui-redesign）

> 参考路径：`deep-agents-ui/doc/component-architecture.md`；需求依据：`specs/002-dialog-ui-redesign/spec.md`、`requirements/context.md`

## 0. 目标与范围

- 统一对话页的消息流、工具调用（含生成式 UI/审批/回退）、子代理、任务/文件侧栏、线程列表、配置/文件弹窗、输入与流控制的视觉与交互。
- 保持暗色为主、浅色可用，桌面优先，兼容窄屏。

## 1. 布局总览

- 页面骨架：主列 + 可选侧栏（线程/任务文件）。
- 主列：桌面宽度 960–1200px 居中；窄屏 100%。
- 侧栏：320px，可收起；收起时保留 48px 触发条。
- 间距/圆角/阴影：区块间 12–16px，内边距 12–16px，圆角 12px，阴影 4–6dp（hover 6–8dp）。

## 2. 消息流（ChatMessage）

- 人类消息：右对齐浅底气泡，头像/首字母，时间戳次级文本。
- AI 消息：左对齐中性底；Markdown 统一行高 1.6，代码块暗底，长行软换行 + 横向滚动备选。
- 子代理：在消息头显示 SubAgent 徽标与类型，状态点继承工具状态色；与工具卡保持 8px 间距。
- 滚动与锚点：新消息到达时保留当前位置，出现“跳转至新消息”浮标；极长对话保持平滑滚动。

## 3. 工具调用（ToolCallBox）— 玻璃态渐变风格（需对齐附件图）

- 头部骨架：顶部 3px 状态色条（pending 主色、completed 绿、error 红、interrupted 橙）+ 左侧 lucide 14–16px 图标 + 工具名（14px semibold）+ 状态徽章；右上 chevron 折叠。徽章浅底深字，同状态色。
- 玻璃态与渐变：背景浅色线性渐变（纵向 4–8% 差值），叠加 8–12px 模糊；描边半透明并带 30–40% 状态/主色霓虹辉光；阴影 4–6dp，hover 6–8dp，禁止位移。
- 内容模式（按工具类型，未命中用回退 Arguments+Result）：
  - 搜索：1–2 列玻璃网格卡，hover 微上浮 + 霓虹描边；展示标题/域名/时间/摘要，可选耗时徽章。
  - 读文件：路径/大小/mtime 胶囊；预览框渐变描边 + 轻阴影，截断 6–8 行可展开；二进制提示下载。
  - 写/编辑：信息条 + 统计胶囊（字节/行数/校验）+ Diff/预览双卡片，单槽限高 240–320px，超出滚动。
  - 目录：玻璃态列表，文件夹/文件图标带主色辉光，右侧 size/mtime；列表内滚动。
  - TODO：分组卡（待办/进行中/已完成）带组色条；行级状态胶囊，hover 提升。
  - 回退：Arguments + Result 玻璃卡，可折叠；错误信息置底可折叠红色细条。
- 骨架/空态：pending/streaming 显示 shimmer；无内容时显示“等待返回…”，保留头部与状态条。
- 交互/可达性：展开/收起 200–250ms 淡入；键盘 Tab 可达，ARIA 覆盖标题、折叠、状态徽章、错误条；错误不遮挡已加载内容。
- 响应式：≤768px 单列，padding 约 12px；状态条/徽章 0.875x；预览/Diff 高度同步收敛。

## 4. 审批交互（ToolApprovalInterrupt）

- 头部沿用工具卡样式，状态条与徽章一致。
- 主体：审批说明、参数编辑区、可选拒绝理由输入；字段分组使用浅分隔线。
- 按钮：主要/次要/幽灵态，含禁用与加载态；提交后显示摘要行。
- 键盘可达：Tab 顺序标题 → 状态 → 折叠 → 主要操作；Esc 收起。

## 5. 生成式 UI（LoadExternalComponent）

- 占位：加载骨架 + 渐变描边框；失败时显示降级提示与“重试/查看回退”按钮。
- 容器与 ToolCallBox 同圆角/描边/阴影；避免嵌套多层容器导致视觉噪声。

## 6. 任务与文件（TasksFilesSidebar / FilesPopover / FileViewDialog）

- 侧栏头：标题 + 计数徽章 + 折叠按钮；新增内容时提示展开。
- 任务：pending/in_progress/completed 分组；行级状态胶囊；hover 描边。
- 文件：卡片展示名称/大小/mtime/可编辑标识；空态文案 + 重试入口。
- FileViewDialog：统一遮罩/圆角/按钮排布；只读态与可编辑态视觉区分。

## 7. 线程列表（ThreadList）

- 列表项：标题 + 描述 + 更新时间 + 状态徽章；选中态高亮描边。
- 分组/过滤：顶部轻量 tab；空/错误态有文案与重试。
- 关闭返回：保持对话滚动位置与输入值。

## 8. 输入与流控制

- 输入框：Enter 发送、Shift+Enter 换行；占位文案随 idle/loading/interrupt 变化。
- 按钮：发送、停止/继续并排；加载态禁用发送，停止显式红/橙。
- 辅助：快捷键提示，错误时在输入下方显示轻量提示条。

## 9. 动效与可达性

- 过渡：展开/收起、hover、状态切换 200–300ms 淡入/描边增强；避免大幅位移。
- 可达性：焦点样式可见；ARIA 覆盖标题、折叠、链接、状态文本。
- 性能：单卡渲染 <16ms；长内容截断并滚动，防止版式抖动。

## 10. 主题与令牌（建议）

- 色板：沿用主题 token（背景、muted、border、primary、destructive、warning、success），状态色同步工具卡辉光。
- 字体：标题 14px semibold，正文 12–13px，辅助 11px。
- 圆角/阴影：卡片 r=12，按钮 r=8，阴影 4–6dp；hover 描边增强不位移。
- 间距：卡片内 padding 12–16px；列表行 12px；区块间 12–16px。

## 11. 状态 / 空态 / 错误态

- 空态：图标 + 文案 + 二级说明 + 操作（重试/创建），不留空白。
- 错误：红色细条 + 文案，可折叠；不遮挡已加载内容。
- 中断：顶部状态条橙色，输入区提示“对话已中断，可继续/重试”。

## 12. 响应式与窄屏

- ≤768px：主列 100%；侧栏转底部抽屉；工具卡单列。
- 代码块与网格降级：单列，预览高度限制并可滚动。

## 13. 验收对照（映射 spec）

- SC-001：人类/AI/工具/子代理清晰边界与状态徽章。
- SC-002：工具卡展开/收起 <0.5s，无明显抖动。
- SC-003：长 Markdown/代码在桌面与移动可读，无横向溢出为主。
- SC-004：任务/文件新增后 2 次点击内可定位；空/错态有文案。
- SC-005：审批 10 秒内完成并显示反馈，参数编辑后有摘要。
- SC-006：全组件统一主题，无残留旧样式。
